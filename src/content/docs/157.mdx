---
id: 157
state: approved
slug: partial-responses
created: 2023-01-22T00:00:00.000Z
placement:
  category: design-patterns
title: Partial responses

--- 
import { Aside, Tabs, TabItem } from '@astrojs/starlight/components';

# Partial responses

Sometimes, a resource can be either large or expensive to compute, and the API
needs to give the user control over which fields it sends back.

## Guidance

APIs <b class="font-extrabold text-green-700">may</b> support partial responses in one of two ways:

### `read_mask` parameter

Field masks can be used for granting the user fine-grained control over what
fields are returned. An API <b class="font-extrabold	text-yellow-700">should</b> support the mask as a request field
named `read_mask`.

- The `read_mask` parameter <b class="font-extrabold	text-red-700">must</b> be optional:
  - An explicit value of `"*"` <b class="font-extrabold	text-yellow-700">should</b> be supported, and <b class="font-extrabold	text-red-700">must</b> return all
    fields.
  - If `read_mask` is omitted, it <b class="font-extrabold	text-red-700">must</b> default to `"*"`, unless otherwise
    documented.
- An API <b class="font-extrabold text-green-700">may</b> allow read masks with non-terminal repeated fields (unlike
  update masks), but is not obligated to do so.

<Aside type="note" title="Note">
  Changing the default value of `read_mask` is a
  [breaking change](./backwards-compatibility#semantic-changes).
</Aside>


<Tabs>
  <TabItem label="Protocol Buffers">
  
  
  - The value of `read_mask` <b class="font-extrabold	text-red-700">must</b> be a `google.protobuf.FieldMask`.
  
    **Warning:** There is a known conflict between the guidance about
    non-terminal repeated fields guidance and the documentation of `FieldMask`
    itself:
    [google/protobuf/field_mask.proto](https://github.com/protocolbuffers/protobuf/blob/5e84a6169cf0f9716c9285c95c860bcb355dbdc1/src/google/protobuf/field_mask.proto#L85-L86)
    states that
    `A repeated field is not allowed except at the last position of a paths string.`
    As such, official libraries (such as `Merge` for FieldMasks) may not support
    wildcards without additional work. Track the issue
    [here](https://github.com/protocolbuffers/protobuf/issues/8547#issuecomment-2005180068).
    Consider using the view enumeration pattern described below instead instead.
  
  
  </TabItem>
  <TabItem label="OpenAPI 3.0">
  
  
  **Note:** OAS example not yet written.
  
  
  </TabItem>
</Tabs>
    

### View enumeration

Alternatively, an API <b class="font-extrabold text-green-700">may</b> support partial responses with view enums. View
enums are useful for situations where an API only wants to expose a small
number of permutations to the user:

- The enum <b class="font-extrabold	text-yellow-700">should</b> be specified as a `view` field on the request message.
- The `UNSPECIFIED` value <b class="font-extrabold	text-red-700">must</b> be valid (not an error), and the API
  <b class="font-extrabold	text-red-700">must</b> document what the unspecified value will do.
  - For List methods, the effective default value <b class="font-extrabold	text-yellow-700">should</b> be `BASIC`.
  - For Get methods, the effective default value <b class="font-extrabold	text-yellow-700">should</b> be either `BASIC`
    or `FULL`.
- APIs <b class="font-extrabold text-green-700">may</b> add fields to a given view over time. APIs <b class="font-extrabold	text-red-700">must not</b> remove a
  field from a given view (this is a breaking change).

<Aside type="note" title="Note">
  The implicit `PATH_ONLY` view described by
  [resource association via embedded resources](.association/#embedded-resources)
  <b class="font-extrabold	text-yellow-700">should not</b> be explicitly defined in the view enum.
</Aside>


<Tabs>
  <TabItem label="Protocol Buffers">
  
  
  ```proto
  enum BookView {
    // The default / unset value.
    // The API will default to the BASIC view.
    BOOK_VIEW_UNSPECIFIED = 0;
  
    // Include basic metadata about the book, but not the full contents.
    // This is the default value (for both ListBooks and GetBook).
    BOOK_VIEW_BASIC = 1;
  
    // Include everything.
    BOOK_VIEW_FULL = 2;
  }
  ```
  
  - The enum <b class="font-extrabold	text-yellow-700">should</b> be defined within the resource; methods can reference it
    as e.g. `Book.View`.
  - The enum <b class="font-extrabold	text-yellow-700">should</b> be named something ending in `-View`
  - The enum <b class="font-extrabold	text-yellow-700">should</b> at minimum have values named `BASIC` and `FULL` (although
    it <b class="font-extrabold text-green-700">may</b> have values other than these).
  
  
  </TabItem>
  <TabItem label="OpenAPI 3.0">
  
  
  **Note:** OAS example not yet written.
  
  
  </TabItem>
</Tabs>
    
