---
id: 136
state: approved
slug: custom-methods
created: 2019-01-25T00:00:00.000Z
updated: 2024-03-08T00:00:00.000Z
placement:
  category: standard-methods
  order: 100
title: Custom methods

--- 
import { Aside, Tabs, TabItem } from '@astrojs/starlight/components';

# Custom methods

Resource oriented design (AEP-121) uses custom methods to provide a means to
express actions that are difficult to model using only the standard methods.
Custom methods are important because they provide a means for an API's
vocabulary to adhere to user intent.

## Guidance

Custom methods <b class="font-extrabold	text-yellow-700">should</b> only be used for functionality that can not be
expressed via standard methods; prefer standard methods if possible, due to
their consistent semantics. However, APIs <b class="font-extrabold	text-yellow-700">should not</b> contort things to
endeavor to make the standard methods "sort of work".

While custom methods vary widely in how they are designed, many principles
apply consistently:

- The HTTP method for custom methods <b class="font-extrabold	text-yellow-700">should</b> be selected based on the
  semantics described by [RFC 7231 section 4.3] and [RFC 5789] for `PATCH`. In
  practice, the vast majority of custom methods <b class="font-extrabold	text-yellow-700">should</b> use `POST` or `GET`.
  - Custom methods that serve as an alternative to get or list methods (such as
    `Search`) <b class="font-extrabold	text-yellow-700">should</b> use `GET`, and require no request body. These methods
    <b class="font-extrabold	text-red-700">must</b> be idempotent and have no state changes or side effects (they
    should be safe as defined in [RFC 7231 section 4.2.1][]).
  - Custom methods <b class="font-extrabold	text-yellow-700">should not</b> use `PATCH` or `DELETE`.
- The HTTP URI <b class="font-extrabold	text-red-700">must</b> use a `:` character followed by the custom verb
  (`:archive` in the above example), and the verb in the URI <b class="font-extrabold	text-red-700">must</b> match the
  verb in the name of the RPC.
  - If word separation is required, `camelCase` <b class="font-extrabold	text-red-700">must</b> be used.


<Tabs>
  <TabItem label="Protocol Buffers">
  
  
  
        ```protobuf
        // Copyright 2020 Google LLC
  //
  // Licensed under the Apache License, Version 2.0 (the "License");
  // you may not use this file except in compliance with the License.
  // You may obtain a copy of the License at
  //
  //     https://www.apache.org/licenses/LICENSE-2.0
  //
  // Unless required by applicable law or agreed to in writing, software
  // distributed under the License is distributed on an "AS IS" BASIS,
  // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  // See the License for the specific language governing permissions and
  // limitations under the License.
  
  syntax = "proto3";
  
  import "google/api/annotations.proto";
  import "google/api/field_behavior.proto";
  import "google/api/resource.proto";
  
  // A service representing a library.
  service Library {
    // Archives the given book.
    rpc ArchiveBook(ArchiveBookRequest) returns (ArchiveBookResponse) {
      option (google.api.http) = {
        post: "/v1/{path=publishers/*/books/*}:archive"
        body: "*"
      };
    }
  
    // Sorts the books from this publisher.
    rpc SortBooks(SortBooksRequest) returns (SortBooksResponse) {
      option (google.api.http) = {
        post: "/v1/{parent=publishers/*}/books:sort"
        body: "*"
      };
    }
  }
  
  // Request message to archive a book.
  message ArchiveBookRequest {
    // The path of the book to retrieve.
    string path = 1 [
      (google.api.field_behavior) = REQUIRED,
      (google.api.resource_reference) = {
        type: "library.googleapis.com/Book"
      }];
  
    // The target format for the archived book.
    // Must be "application/pdf", "application/rtf", or "application/epub+zip"
    string mime_type = 2;
  }
  
  // Response message for archiving a book.
  message ArchiveBookResponse {
    // The location of the archived book
    string uri = 1;
  }
  
  // Request message to sort a collection of books.
  message SortBooksRequest {
    // The path of the publisher to sort books for.
    string parent = 1 [
      (google.api.field_behavior) = REQUIRED,
      (google.api.resource_reference) = {
        type: "library.googleapis.com/Publisher"
      }];
  
    // The property of the book to sort by.
    // If not provided, "title" is used.
    string field = 2;
  }
  
  // Response message for a sorted collection of books.
  message SortBooksResponse {}
  
  // A representation of a single book.
  message Book {
    option (google.api.resource) = {
      type: "library.googleapis.com/Book"
      pattern: "publishers/{publisher}/books/{book}"
    };
  
    // The path of the book.
    // Format: publishers/{publisher}/books/{book}
    string path = 1;
  
    // The ISBN (International Standard Book Number) for this book.
    string isbn = 2;
  
    // The title of the book.
    string title = 3;
  
    // The author or authors of the book.
    repeated string authors = 4;
  
    // The rating assigned to the book.
    float rating = 5;
  }
  
        ```
      
  
  - The name of the RPC <b class="font-extrabold	text-yellow-700">should</b> be a verb followed by a noun.
    - The name <b class="font-extrabold	text-red-700">must not</b> contain prepositions ("for", "with", etc.).
  - The `body` clause in the `google.api.http` annotation <b class="font-extrabold	text-yellow-700">should</b> be `"*"`.
    - However, if using `GET` or `DELETE`, the `body` clause <b class="font-extrabold	text-red-700">must</b> be absent.
  - Custom methods <b class="font-extrabold	text-red-700">must</b> take a request message exactly matching the RPC name,
    with a `Request` suffix. For example, `ArchiveBookRequest`.
  - Custom methods <b class="font-extrabold	text-yellow-700">should</b> return a response message exactly matching the RPC
    name, with a `Response` suffix. For example, `ArchiveBookResponse`.
    - When operating on a specific resource, a custom method <b class="font-extrabold text-green-700">may</b> return the
      resource itself.
  
  
  </TabItem>
  <TabItem label="OpenAPI 3.0">
  
  
  
        ```yml
        ---
  openapi: 3.0.3
  info:
    title: Library
    version: 1.0.0
  paths:
    /publishers/{publisherId}/books/{bookId}:archive:
      post:
        operationId: archiveBook
        description: Archives the given book.
        requestBody:
          description:
          content:
            application/json:
              schema:
                description: Request structure to archive a book.
                properties:
                  mime_type:
                    type: string
                    description: |
                      The target format for the archived book.
                      Must be "application/pdf", "application/rtf", or
                      "application/epub+zip"
                    required: true
                    enum:
                      - application/pdf
                      - application/rtf
                      - application/epub+zip
        responses:
          200:
            description: OK
            content:
              application/json:
                schema:
                  description: Response structure for the archiveBook operation.
                  properties:
                    uri:
                      type: string
                      description: The location of the archived book.
    /publishers/{publisherId}/books:sort:
      post:
        operationId: sortBooks
        description: Sorts the books from this publisher.
        requestBody:
          description: Request structure to sort a collection of books.
          properties:
            field:
              type: string
              description: |
                The property of the book to sort by.
                If not provided, "title" is used.
        responses:
          200:
            description: OK
  components:
    schema:
      Book:
        description: A representation of a single book.
        properties:
          name:
            type: string
            description: |
              The name of the book.
              Format: publishers/{publisher}/books/{book}
          isbn:
            type: string
            description: |
              The ISBN (International Standard Book Number) for this book.
          title:
            type: string
            description: The title of the book.
          authors:
            type: array
            items:
              type: string
            description: The author or authors of the book.
          rating:
            type: float
            description: The rating assigned to the book.
  
        ```
      
  
  - The name of the RPC <b class="font-extrabold	text-yellow-700">should</b> be a verb followed by a noun.
    - The name of the RPC <b class="font-extrabold	text-red-700">must not</b> contain prepositions ("for", "with",
      etc.).
  
  
  </TabItem>
</Tabs>
    

<Aside type="note" title="Note">
  The pattern above shows a custom method that operates on a specific
  resource. Custom methods can be associated with resources, collections, or
  services.
</Aside>

### Resource-based custom methods

Custom methods <b class="font-extrabold	text-red-700">must</b> operate on a resource if the API can be modeled as
such:


<Tabs>
  <TabItem label="Protocol Buffers">
  
  
  
        ```protobuf
        // Copyright 2020 Google LLC
  //
  // Licensed under the Apache License, Version 2.0 (the "License");
  // you may not use this file except in compliance with the License.
  // You may obtain a copy of the License at
  //
  //     https://www.apache.org/licenses/LICENSE-2.0
  //
  // Unless required by applicable law or agreed to in writing, software
  // distributed under the License is distributed on an "AS IS" BASIS,
  // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  // See the License for the specific language governing permissions and
  // limitations under the License.
  
  syntax = "proto3";
  
  import "google/api/annotations.proto";
  import "google/api/field_behavior.proto";
  import "google/api/resource.proto";
  
  // A service representing a library.
  service Library {
    // Archives the given book.
    rpc ArchiveBook(ArchiveBookRequest) returns (ArchiveBookResponse) {
      option (google.api.http) = {
        post: "/v1/{path=publishers/*/books/*}:archive"
        body: "*"
      };
    }
  
    // Sorts the books from this publisher.
    rpc SortBooks(SortBooksRequest) returns (SortBooksResponse) {
      option (google.api.http) = {
        post: "/v1/{parent=publishers/*}/books:sort"
        body: "*"
      };
    }
  }
  
  // Request message to archive a book.
  message ArchiveBookRequest {
    // The path of the book to retrieve.
    string path = 1 [
      (google.api.field_behavior) = REQUIRED,
      (google.api.resource_reference) = {
        type: "library.googleapis.com/Book"
      }];
  
    // The target format for the archived book.
    // Must be "application/pdf", "application/rtf", or "application/epub+zip"
    string mime_type = 2;
  }
  
  // Response message for archiving a book.
  message ArchiveBookResponse {
    // The location of the archived book
    string uri = 1;
  }
  
  // Request message to sort a collection of books.
  message SortBooksRequest {
    // The path of the publisher to sort books for.
    string parent = 1 [
      (google.api.field_behavior) = REQUIRED,
      (google.api.resource_reference) = {
        type: "library.googleapis.com/Publisher"
      }];
  
    // The property of the book to sort by.
    // If not provided, "title" is used.
    string field = 2;
  }
  
  // Response message for a sorted collection of books.
  message SortBooksResponse {}
  
  // A representation of a single book.
  message Book {
    option (google.api.resource) = {
      type: "library.googleapis.com/Book"
      pattern: "publishers/{publisher}/books/{book}"
    };
  
    // The path of the book.
    // Format: publishers/{publisher}/books/{book}
    string path = 1;
  
    // The ISBN (International Standard Book Number) for this book.
    string isbn = 2;
  
    // The title of the book.
    string title = 3;
  
    // The author or authors of the book.
    repeated string authors = 4;
  
    // The rating assigned to the book.
    float rating = 5;
  }
  
        ```
      
  
  - The parameter for the resource's path <b class="font-extrabold	text-red-700">must</b> be called `path`, and <b class="font-extrabold	text-red-700">must</b>
    be the only variable in the URI path.
  
  
  </TabItem>
  <TabItem label="OpenAPI 3.0">
  
  
  **Note:** OAS example not yet written.
  
  
  </TabItem>
</Tabs>
    

### Collection-based custom methods

While most custom methods operate on a single resource, some custom methods
<b class="font-extrabold text-green-700">may</b> operate on a collection instead:


<Tabs>
  <TabItem label="Protocol Buffers">
  
  
  
        ```protobuf
        // Copyright 2020 Google LLC
  //
  // Licensed under the Apache License, Version 2.0 (the "License");
  // you may not use this file except in compliance with the License.
  // You may obtain a copy of the License at
  //
  //     https://www.apache.org/licenses/LICENSE-2.0
  //
  // Unless required by applicable law or agreed to in writing, software
  // distributed under the License is distributed on an "AS IS" BASIS,
  // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  // See the License for the specific language governing permissions and
  // limitations under the License.
  
  syntax = "proto3";
  
  import "google/api/annotations.proto";
  import "google/api/field_behavior.proto";
  import "google/api/resource.proto";
  
  // A service representing a library.
  service Library {
    // Archives the given book.
    rpc ArchiveBook(ArchiveBookRequest) returns (ArchiveBookResponse) {
      option (google.api.http) = {
        post: "/v1/{path=publishers/*/books/*}:archive"
        body: "*"
      };
    }
  
    // Sorts the books from this publisher.
    rpc SortBooks(SortBooksRequest) returns (SortBooksResponse) {
      option (google.api.http) = {
        post: "/v1/{parent=publishers/*}/books:sort"
        body: "*"
      };
    }
  }
  
  // Request message to archive a book.
  message ArchiveBookRequest {
    // The path of the book to retrieve.
    string path = 1 [
      (google.api.field_behavior) = REQUIRED,
      (google.api.resource_reference) = {
        type: "library.googleapis.com/Book"
      }];
  
    // The target format for the archived book.
    // Must be "application/pdf", "application/rtf", or "application/epub+zip"
    string mime_type = 2;
  }
  
  // Response message for archiving a book.
  message ArchiveBookResponse {
    // The location of the archived book
    string uri = 1;
  }
  
  // Request message to sort a collection of books.
  message SortBooksRequest {
    // The path of the publisher to sort books for.
    string parent = 1 [
      (google.api.field_behavior) = REQUIRED,
      (google.api.resource_reference) = {
        type: "library.googleapis.com/Publisher"
      }];
  
    // The property of the book to sort by.
    // If not provided, "title" is used.
    string field = 2;
  }
  
  // Response message for a sorted collection of books.
  message SortBooksResponse {}
  
  // A representation of a single book.
  message Book {
    option (google.api.resource) = {
      type: "library.googleapis.com/Book"
      pattern: "publishers/{publisher}/books/{book}"
    };
  
    // The path of the book.
    // Format: publishers/{publisher}/books/{book}
    string path = 1;
  
    // The ISBN (International Standard Book Number) for this book.
    string isbn = 2;
  
    // The title of the book.
    string title = 3;
  
    // The author or authors of the book.
    repeated string authors = 4;
  
    // The rating assigned to the book.
    float rating = 5;
  }
  
        ```
      
  
  
  </TabItem>
  <TabItem label="OpenAPI 3.0">
  
  
  
        ```yml
        ---
  openapi: 3.0.3
  info:
    title: Library
    version: 1.0.0
  paths:
    /publishers/{publisherId}/books/{bookId}:archive:
      post:
        operationId: archiveBook
        description: Archives the given book.
        requestBody:
          description:
          content:
            application/json:
              schema:
                description: Request structure to archive a book.
                properties:
                  mime_type:
                    type: string
                    description: |
                      The target format for the archived book.
                      Must be "application/pdf", "application/rtf", or
                      "application/epub+zip"
                    required: true
                    enum:
                      - application/pdf
                      - application/rtf
                      - application/epub+zip
        responses:
          200:
            description: OK
            content:
              application/json:
                schema:
                  description: Response structure for the archiveBook operation.
                  properties:
                    uri:
                      type: string
                      description: The location of the archived book.
    /publishers/{publisherId}/books:sort:
      post:
        operationId: sortBooks
        description: Sorts the books from this publisher.
        requestBody:
          description: Request structure to sort a collection of books.
          properties:
            field:
              type: string
              description: |
                The property of the book to sort by.
                If not provided, "title" is used.
        responses:
          200:
            description: OK
  components:
    schema:
      Book:
        description: A representation of a single book.
        properties:
          name:
            type: string
            description: |
              The name of the book.
              Format: publishers/{publisher}/books/{book}
          isbn:
            type: string
            description: |
              The ISBN (International Standard Book Number) for this book.
          title:
            type: string
            description: The title of the book.
          authors:
            type: array
            items:
              type: string
            description: The author or authors of the book.
          rating:
            type: float
            description: The rating assigned to the book.
  
        ```
      
  
  
  </TabItem>
</Tabs>
    

- If the collection has a parent, the field name in the request message
  <b class="font-extrabold	text-yellow-700">should</b> be `parent`.
- The collection key (`books` in the above example) <b class="font-extrabold	text-red-700">must</b> be literal.

### Stateless methods

Some custom methods are not attached to resources at all. These methods are
generally _stateless_: they accept a request and return a response, and have no
permanent effect on data within the API.


<Tabs>
  <TabItem label="Protocol Buffers">
  
  
  
        ```protobuf
        // Copyright 2020 Google LLC
  //
  // Licensed under the Apache License, Version 2.0 (the "License");
  // you may not use this file except in compliance with the License.
  // You may obtain a copy of the License at
  //
  //     https://www.apache.org/licenses/LICENSE-2.0
  //
  // Unless required by applicable law or agreed to in writing, software
  // distributed under the License is distributed on an "AS IS" BASIS,
  // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  // See the License for the specific language governing permissions and
  // limitations under the License.
  
  syntax = "proto3";
  
  import "google/api/annotations.proto";
  import "google/api/field_behavior.proto";
  
  // A service for translating text.
  service Translate {
    // Translates the provided text from one language to another.
    rpc TranslateText(TranslateTextRequest) returns (TranslateTextResponse) {
      option (google.api.http) = {
        post: "/v1/{project=projects/*}:translateText"
        body: "*"
      };
    }
  }
  
  // The request message for text translation.
  message TranslateTextRequest {
    // The contents of the input, as a string.
    repeated string contents = 1
      [(google.api.field_behavior) = REQUIRED];
  
    // The BCP-47 language code of the input text (e.g. "en-US").
    // If the source language is not specified, the service will attempt
    // to infer it.
    string source_language_code = 2;
  
    // The BCP-47 language code of the output text (e.g. "en-US").
    string target_language_code = 3
      [(google.api.field_behavior) = REQUIRED];
  }
  
  // The response message for text translation.
  message TranslateTextResponse {
    // Text translated into the target language.
    string translated_text = 1;
  
    // The BCP-47 language code of source text in the initial request,
    // if it was detected automatically.
    string detected_language_code = 2;
  }
  
        ```
      
  
  
  </TabItem>
  <TabItem label="OpenAPI 3.0">
  
  
  
        ```yml
        ---
  openapi: 3.0.3
  info:
    title: Library
    version: 1.0.0
  paths:
    /projects/{projectId}:translateText:
      post:
        operationId: translateText
        description: Translates the provided text from one language to another.
        requestBody:
          description:
          content:
            application/json:
              schema:
                description: Request structure to translate text.
                properties:
                  contents:
                    type: array
                    items:
                      type: string
                    description: The contents of the input, as a string.
                  source_language_code:
                    type: string
                    description: |
                      The BCP-47 language code of the input text (e.g. "en-US").
                      If the source language is not specified, the service will
                      attempt to infer it.
                  target_language_code:
                    type: string
                    description: |
                      The BCP-47 language code of the output text (e.g. "en-US").
        responses:
          200:
            description: OK
            content:
              application/json:
                schema:
                  description: |
                    Response structure for the translateText operation.
                  properties:
                    translated_text:
                      type: string
                      description: |
                        Text translated into the target language.
                    detected_language_code:
                      type: string
                      description: |
                        The BCP-47 language code of source text in the initial
                        request, if it was detected automatically.
  
        ```
      
  
  
  </TabItem>
</Tabs>
    

- If the method runs in a particular scope (such as a project, as in the above
  example), the field name in the request message <b class="font-extrabold	text-yellow-700">should</b> be the name of the
  scope resource. If word separators are necessary, `snake_case` <b class="font-extrabold	text-red-700">must</b> be
  used.
- The URI <b class="font-extrabold	text-yellow-700">should</b> place both the verb and noun after the `:` separator
  (avoid a "faux collection key" in the URI in this case, as there is no
  collection). For example, `:translateText` is preferable to `text:translate`.
- Stateless methods <b class="font-extrabold	text-red-700">must</b> use `POST` if they involve billing.

### Declarative-friendly resources

Declarative-friendly resources usually <b class="font-extrabold	text-yellow-700">should not</b> employ custom methods
(except specific declarative-friendly custom methods discussed in other AEPs),
because declarative-friendly tools are unable to automatically determine what
to do with them.

An exception to this is for rarely-used, fundamentally imperative operations,
such as a `Move`, `Rename`, or `Restart` operation, for which there would not
be an expectation of declarative support.

{/* prettier-ignore-start  */}
[rfc 5789]: https://datatracker.ietf.org/doc/html/rfc5789
[rfc 7231 section 4.2.1]: https://datatracker.ietf.org/doc/html/rfc7231#section-4.2.1
[rfc 7231 section 4.3]: https://datatracker.ietf.org/doc/html/rfc7231#section-4.3
{/* prettier-ignore-end  */}
