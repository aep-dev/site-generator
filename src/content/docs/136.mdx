---
id: 136
state: approved
slug: custom-methods
created: 2019-01-25T00:00:00.000Z
updated: 2024-03-08T00:00:00.000Z
placement:
  category: standard-methods
  order: 100
title: Custom methods

--- 
import { Aside, Tabs, TabItem } from '@astrojs/starlight/components';
import Sample from '../../components/Sample.astro';

# Custom methods

Resource oriented design (AEP-121) uses custom methods to provide a means to
express actions that are difficult to model using only the standard methods.
Custom methods are important because they provide a means for an API's
vocabulary to adhere to user intent.

## Guidance

Custom methods <b class="font-extrabold	text-yellow-700">should</b> only be used for functionality that can not be
expressed via standard methods; prefer standard methods if possible, due to
their consistent semantics. However, APIs <b class="font-extrabold	text-yellow-700">should not</b> contort things to
endeavor to make the standard methods "sort of work".

While custom methods vary widely in how they are designed, many principles
apply consistently:

- The HTTP method for custom methods <b class="font-extrabold	text-yellow-700">should</b> be selected based on the
  semantics described by [RFC 7231 section 4.3] and [RFC 5789] for `PATCH`. In
  practice, the vast majority of custom methods <b class="font-extrabold	text-yellow-700">should</b> use `POST` or `GET`.
  - Custom methods that serve as an alternative to get or list methods (such as
    `Search`) <b class="font-extrabold	text-yellow-700">should</b> use `GET`, and require no request body. These methods
    <b class="font-extrabold	text-red-700">must</b> be idempotent and have no state changes or side effects (they
    should be safe as defined in [RFC 7231 section 4.2.1][]).
  - Custom methods <b class="font-extrabold	text-yellow-700">should not</b> use `PATCH` or `DELETE`.
- The HTTP URI <b class="font-extrabold	text-red-700">must</b> use a `:` character followed by the custom verb
  (`:archive` in the above example), and the verb in the URI <b class="font-extrabold	text-red-700">must</b> match the
  verb in the name of the RPC.
  - If word separation is required, `camelCase` <b class="font-extrabold	text-red-700">must</b> be used.


<Tabs>
  <TabItem label="Protocol Buffers">
  
  
  <Sample path="../aep.dev/aep/general/0136/library.proto" type="protobuf" />
  
  - The name of the RPC <b class="font-extrabold	text-yellow-700">should</b> be a verb followed by a noun.
    - The name <b class="font-extrabold	text-red-700">must not</b> contain prepositions ("for", "with", etc.).
  - The `body` clause in the `google.api.http` annotation <b class="font-extrabold	text-yellow-700">should</b> be `"*"`.
    - However, if using `GET` or `DELETE`, the `body` clause <b class="font-extrabold	text-red-700">must</b> be absent.
  - Custom methods <b class="font-extrabold	text-red-700">must</b> take a request message exactly matching the RPC name,
    with a `Request` suffix. For example, `ArchiveBookRequest`.
  - Custom methods <b class="font-extrabold	text-yellow-700">should</b> return a response message exactly matching the RPC
    name, with a `Response` suffix. For example, `ArchiveBookResponse`.
    - When operating on a specific resource, a custom method <b class="font-extrabold text-green-700">may</b> return the
      resource itself.
  
  
  </TabItem>
  <TabItem label="OpenAPI 3.0">
  
  
  <Sample path="../aep.dev/aep/general/0136/library.oas.yaml" type="yml" />
  
  - The name of the RPC <b class="font-extrabold	text-yellow-700">should</b> be a verb followed by a noun.
    - The name of the RPC <b class="font-extrabold	text-red-700">must not</b> contain prepositions ("for", "with",
      etc.).
  
  
  </TabItem>
</Tabs>
    

<Aside type="note" title="Note">
  The pattern above shows a custom method that operates on a specific
  resource. Custom methods can be associated with resources, collections, or
  services.
</Aside>

### Resource-based custom methods

Custom methods <b class="font-extrabold	text-red-700">must</b> operate on a resource if the API can be modeled as
such:


<Tabs>
  <TabItem label="Protocol Buffers">
  
  
  <Sample path="../aep.dev/aep/general/0136/library.proto" type="protobuf" />
  
  - The parameter for the resource's path <b class="font-extrabold	text-red-700">must</b> be called `path`, and <b class="font-extrabold	text-red-700">must</b>
    be the only variable in the URI path.
  
  
  </TabItem>
  <TabItem label="OpenAPI 3.0">
  
  
  **Note:** OAS example not yet written.
  
  
  </TabItem>
</Tabs>
    

### Collection-based custom methods

While most custom methods operate on a single resource, some custom methods
<b class="font-extrabold text-green-700">may</b> operate on a collection instead:


<Tabs>
  <TabItem label="Protocol Buffers">
  
  
  <Sample path="../aep.dev/aep/general/0136/library.proto" type="protobuf" />
  
  
  </TabItem>
  <TabItem label="OpenAPI 3.0">
  
  
  <Sample path="../aep.dev/aep/general/0136/library.oas.yaml" type="yml" />
  
  
  </TabItem>
</Tabs>
    

- If the collection has a parent, the field name in the request message
  <b class="font-extrabold	text-yellow-700">should</b> be `parent`.
- The collection key (`books` in the above example) <b class="font-extrabold	text-red-700">must</b> be literal.

### Stateless methods

Some custom methods are not attached to resources at all. These methods are
generally _stateless_: they accept a request and return a response, and have no
permanent effect on data within the API.


<Tabs>
  <TabItem label="Protocol Buffers">
  
  
  <Sample path="../aep.dev/aep/general/0136/translate.proto" type="protobuf" />
  
  
  </TabItem>
  <TabItem label="OpenAPI 3.0">
  
  
  <Sample path="../aep.dev/aep/general/0136/translate.oas.yaml" type="yml" />
  
  
  </TabItem>
</Tabs>
    

- If the method runs in a particular scope (such as a project, as in the above
  example), the field name in the request message <b class="font-extrabold	text-yellow-700">should</b> be the name of the
  scope resource. If word separators are necessary, `snake_case` <b class="font-extrabold	text-red-700">must</b> be
  used.
- The URI <b class="font-extrabold	text-yellow-700">should</b> place both the verb and noun after the `:` separator
  (avoid a "faux collection key" in the URI in this case, as there is no
  collection). For example, `:translateText` is preferable to `text:translate`.
- Stateless methods <b class="font-extrabold	text-red-700">must</b> use `POST` if they involve billing.

### Declarative-friendly resources

Declarative-friendly resources usually <b class="font-extrabold	text-yellow-700">should not</b> employ custom methods
(except specific declarative-friendly custom methods discussed in other AEPs),
because declarative-friendly tools are unable to automatically determine what
to do with them.

An exception to this is for rarely-used, fundamentally imperative operations,
such as a `Move`, `Rename`, or `Restart` operation, for which there would not
be an expectation of declarative support.

{/* prettier-ignore-start  */}
[rfc 5789]: https://datatracker.ietf.org/doc/html/rfc5789
[rfc 7231 section 4.2.1]: https://datatracker.ietf.org/doc/html/rfc7231#section-4.2.1
[rfc 7231 section 4.3]: https://datatracker.ietf.org/doc/html/rfc7231#section-4.3
{/* prettier-ignore-end  */}
