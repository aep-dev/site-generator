---
import type { Props } from "@astrojs/starlight/props";
import Default from "@astrojs/starlight/components/Sidebar.astro";
import * as fs from "fs";
import { assembleSidebarsByEdition } from "../../utils/sidebar-from-site-structure";
import type { SiteStructure } from "../../utils/site-structure";

// Load site structure and build edition-specific sidebars
const siteStructure: SiteStructure = JSON.parse(
  fs.readFileSync("generated/site-structure.json", "utf-8"),
);
const sidebarsByEdition = assembleSidebarsByEdition(siteStructure);

// Get edition from locals (set by middleware)
const edition = Astro.locals.edition || "general";

// Get the sidebar for this edition
const editionSidebar = sidebarsByEdition[edition] || sidebarsByEdition["general"] || [];

// Override the sidebar prop with edition-specific sidebar
const customProps: Props = {
  ...Astro.props,
  sidebar: editionSidebar,
};
---

<Default {...customProps} />
