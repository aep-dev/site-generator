---
import editionsConfig from '../../aep-editions.json'
import { getEditionFromPath, getVersionedPath, isLatestEdition } from '../utils/versions'

const currentEdition = getEditionFromPath(editionsConfig, Astro.url.pathname)
const latestEdition = editionsConfig.editions.find(e => isLatestEdition(e))

const isOlderVersion = !isLatestEdition(currentEdition)
const latestUrl = latestEdition ? getVersionedPath(editionsConfig, Astro.url.pathname, latestEdition) : null

// Extract AEP ID from path for diff link
const pathSegments = Astro.url.pathname.split('/').filter(Boolean)
const aepId = pathSegments[pathSegments.length - 1]
const isAEPPage = /^\d+$/.test(aepId)
---

{
  isOlderVersion && (
    <div>
      You are viewing {currentEdition.name}.
      {isAEPPage && latestEdition && (
        <>
          <a href={`/diff/${aepId}?from=${currentEdition?.name}&to=${latestEdition.name}`}>
            See what changed
          </a> or <a href={latestUrl}>view {latestEdition.name}</a>.
        </>
      )}
      {!isAEPPage && latestUrl && (
        <>
          <a href={latestUrl}>View latest edition</a>.
        </>
      )}
    </div>
  )
}

<style>
  div {
    background-color: var(--sl-color-blue-low);
    box-shadow: var(--sl-shadow-sm);
    color: var(--sl-color-blue-high);
    font-size: 1.1rem;
    line-height: var(--sl-line-height-headings);
    padding: var(--sl-nav-pad-y) var(--sl-nav-pad-x);
    text-align: center;
    text-wrap: balance;
  }

  div a {
    color: var(--sl-color-blue-high);
  }
</style>
